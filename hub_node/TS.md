# Техническое задание для hub_node

## Цель шага:

Реализовать основные функции `hub_node` для приема регистрации новых узлов и предоставления списка зарегистрированных узлов.

## Функциональность:

*   Реализация REST API-эндпоинта для приема запросов на регистрацию новых узлов (`POST /register_node`).
    *   При получении запроса на регистрацию, `hub_node` должен:
        *   Проверять наличие обязательных параметров в теле запроса (`name`, `type`, `ip_address`, `port`).
        *   Проверять уникальность имени узла.
        *   Генерировать UUID v4 для `id` нового узла.
        *   Сохранять информацию о новом узле в базе данных SQLite.
        *   Возвращать HTTP-ответ с кодом 201 (Created) в случае успешной регистрации, включая `id` зарегистрированного узла в тело ответа.
        *   Возвращать HTTP-ответ с кодом ошибки и информативным сообщением об ошибке в случае неуспешной регистрации (отсутствие параметров, дублирование имени - 409 Conflict, внутренние ошибки - 500 Internal Server Error).
*   Реализация REST API-эндпоинта для предоставления списка зарегистрированных узлов (`GET /nodes`).
    *   При получении запроса на получение списка узлов, `hub_node` должен:
        *   Извлекать информацию о всех зарегистрированных узлах из базы данных SQLite.
        *   Формировать JSON-ответ, содержащий список узлов с их `id` и `type`.
        *   Возвращать HTTP-ответ с кодом 200 (OK) и JSON-списком узлов.
*   **Логирование:**
    *   `hub_node` должен логировать следующие события:
        *   Успешная регистрация нового узла (с указанием `id`, `name`, `type`, `ip_address`, `port`).
        *   Неуспешная регистрация узла (с указанием причины ошибки).
        *   Запрос списка зарегистрированных узлов.
        *   Внутренние ошибки (код 500).

## API:

*   `POST /register_node`:
    *   Метод: POST
    *   URL: `/register_node`
    *   Тело запроса (application/json):
        ```json
        {
          "name": "имя_узла",
          "type": "trusted" или "local",
          "ip_address": "ip_адрес_узла",
          "port": номер_порта_узла
        }
        ```
    *   Успешный ответ (201 Created):
        ```json
        {
          "id": "сгенерированный_uuid"
        }
        ```
    *   Ответ об ошибке (400 Bad Request):
        ```json
        {
          "error": "Сообщение об ошибке"
        }
        ```
    *   Ответ об ошибке (409 Conflict - дублирование имени):
        ```json
        {
          "error": "Имя узла уже занято"
        }
        ```
    *   Ответ об ошибке (500 Internal Server Error):
        ```json
        {
          "error": "Внутренняя ошибка сервера"
        }
        ```
*   `GET /nodes`:
    *   Метод: GET
    *   URL: `/nodes`
    *   Тело запроса: Отсутствует.
    *   Успешный ответ (200 OK):
        ```json
        [
          {"id": "уникальный_id_узла_1", "type": "trusted"},
          {"id": "уникальный_id_узла_2", "type": "local"}
          // ...
        ]
        ```

## База данных:

*   SQLite база данных.
*   Таблица `nodes`:
    *   `id` TEXT PRIMARY KEY (генерируется UUID v4 при регистрации)
    *   `name` TEXT UNIQUE      (имя узла)
    *   `type` TEXT             ("trusted" или "local")
    *   `ip_address` TEXT
    *   `port` INTEGER

## Docker:

*   Создание Dockerfile для `hub_node`, включающего:
    *   Определение базового образа (например, `python:3.9-slim-buster`).
    *   Копирование кода приложения `hub_node`.
    *   Установку необходимых зависимостей (Flask, `uuid`).
    *   Определение порта, который будет прослушивать приложение внутри контейнера, с помощью команды `EXPOSE`.
    *   Определение точки входа для запуска приложения.
    *   Инструкции для запуска приложения при старте контейнера.

## Тестирование (ручное):

1. **Регистрация узла (успешная):**
    *   Запустить `hub_node`.
    *   Отправить `POST`-запрос на `/register_node` с корректными данными нового узла.
    *   Убедиться, что получен HTTP-ответ с кодом 201 и `id` узла в теле ответа.
    *   Проверить, что запись о новом узле появилась в таблице `nodes` базы данных, и `id` является UUID v4.

2. **Регистрация узла (ошибка - отсутствие обязательных параметров):**
    *   Запустить `hub_node`.
    *   Отправить `POST`-запрос на `/register_node` без одного или нескольких обязательных параметров.
    *   Убедиться, что получен HTTP-ответ с кодом 400 и в теле ответа есть сообщение об ошибке.
    *   Проверить, что запись о новом узле не появилась в базе данных.

3. **Регистрация узла (ошибка - дублирование имени):**
    *   Запустить `hub_node`.
    *   Зарегистрировать узел с определенным именем.
    *   Повторно отправить `POST`-запрос на `/register_node` с тем же именем.
    *   Убедиться, что получен HTTP-ответ с кодом 409 и в теле ответа есть сообщение об ошибке.
    *   Проверить, что в базе данных осталась только одна запись с этим именем.

4. **Получение списка узлов (есть зарегистрированные узлы):**
    *   Запустить `hub_node`.
    *   Зарегистрировать несколько узлов.
    *   Отправить `GET`-запрос на `/nodes`.
    *   Убедиться, что получен HTTP-ответ с кодом 200.
    *   Проверить, что тело ответа содержит JSON-список всех зарегистрированных узлов с корректными `id` (UUID v4) и `type`.

5. **Получение списка узлов (нет зарегистрированных узлов):**
    *   Запустить `hub_node` (без предварительной регистрации узлов).
    *   Отправить `GET`-запрос на `/nodes`.
    *   Убедиться, что получен HTTP-ответ с кодом 200.
    *   Проверить, что тело ответа содержит пустой JSON-массив (`[]`).

6. **Внутренняя ошибка сервера:**
    *   Запустить `hub_node`.
    *   Искусственно вызвать внутреннюю ошибку на сервере (например, временно отключить БД или изменить код, чтобы он вызывал исключение).
    *   Отправить любой запрос к API `hub_node`.
    *   Убедиться, что получен HTTP-ответ с кодом 500.

## Документирование:

*   После реализации первого шага создать файл README.md, содержащий:
    *   Краткое описание `hub_node`.
    *   Описание реализованного API (эндпоинты, методы, форматы запросов и ответов, коды ошибок).
    *   Инструкции по сборке Docker-образа.
    *   Инструкции по запуску `hub_node` (локально и в Docker).
    *   Примеры запросов к API (можно использовать `curl` или `Postman`).